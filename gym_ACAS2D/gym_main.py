from gym_ACAS2D.settings import *

from stable_baselines3.common.env_checker import check_env

import numpy as np
import gym
import random
import math

# Initialise random generator
random.seed(RANDOM_SEED)

# Action sequence from episode 1 in model #5 testing.
actions = [0.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.9784011840820312, -0.926813006401062, -0.8743084669113159, -0.8212300539016724, -0.7680001258850099, -0.7151010036468507, -0.6630434393882751, -0.6123300194740295, -0.5634203553199768, -0.5167020559310913, -0.472474068403244, -0.4309389293193817, -0.39220717549324036, -0.3563075661659241, -0.32320091128349304, -0.2927972376346588, -0.2649683654308319, -0.23956343531608582, -0.21641802787780762, -0.19536277651786804, -0.17622941732406616, -0.15885519981384277, -0.1430853307247162, -0.12877482175827026, -0.11578907072544098, -0.1040041595697403, -0.09330661594867706, -0.0835934653878212, -0.07477063685655594, -0.06675335019826889, -0.05946489796042442, -0.05283573642373085, -0.046803299337625504, -0.041311025619506836, -0.0363081730902195, -0.03174867853522301, -0.02759125456213951, -0.023798353970050815, -0.02033623307943344, -0.01717459410429001, -0.014285609126091003, -0.011644639074802399, -0.00922907143831253, -0.007018685340881348, -0.004994966089725494, -0.0031411126255989075, -0.0014419928193092346, 0.00011579692363739014, 0.0015450716018676758, 0.0028572306036949158, 0.0040620192885398865, 0.005169250071048737, 0.006187252700328827, 0.007123589515686035, 0.007985495030879974, 0.008779279887676237, 0.009510912001132965, 0.010185427963733673, 0.010807834565639496, 0.011382423341274261, 0.011913500726222992, 0.012404389679431915, 0.012858651578426361, 0.01327931135892868, 0.013669095933437347, 0.014030642807483671, 0.014366231858730316, 0.014678142964839935, 0.01496811956167221, 0.015238113701343536, 0.015489675104618073, 0.01572442799806595, 0.015943579375743866, 0.016148477792739868, 0.01634027808904648, 0.016520045697689056, 0.0166887566447258, 0.016847357153892517, 0.016996361315250397, 0.017137005925178528, 0.017269693315029144, 0.01739509403705597, 0.017513692378997803, 0.017626225948333737, 0.017733119428157806, 0.01783466339111328, 0.01793145388364792, 0.01802394539117813, 0.018112212419509888, 0.018196873366832733, 0.01827792078256607, 0.018355906009674072, 0.018431000411510468, 0.018503442406654358, 0.018573395907878876, 0.018641099333763123, 0.01870676875114441, 0.01877053827047348, 0.01883244514465332, 0.01889272779226303, 0.018951676785945892, 0.019009284675121307, 0.019065581262111664, 0.019120775163173676, 0.019174955785274506, 0.019228167831897736, 0.01928054541349411, 0.01933232694864273, 0.019383229315280914, 0.01943337172269821, 0.019483163952827454, 0.019532501697540283, 0.01958119124174118, 0.01962944120168686, 0.019677452743053436, 0.019725196063518524, 0.019772551953792572, 0.019819743931293488, 0.019866637885570526, 0.019913427531719208, 0.019960038363933563, 0.02000650018453598, 0.0200529545545578, 0.020099379122257233, 0.020145677030086517, 0.020191974937915802, 0.02023822814226151, 0.020284660160541534, 0.02033095061779022, 0.020377352833747864, 0.02042398601770401, 0.020470552146434784, 0.02051723748445511, 0.020564064383506775, 0.02061092108488083, 0.020658127963542938, 0.020705334842205048, 0.020752735435962677, 0.02080032229423523, 0.02084817737340927, 0.02089599519968033, 0.020944155752658844, 0.020992562174797058, 0.021041177213191986, 0.021089963614940643, 0.021139100193977356, 0.0211884006857872, 0.021237947046756744, 0.021287746727466583, 0.021337859332561493, 0.021388232707977295, 0.0214388370513916, 0.021489731967449188, 0.02154102176427841, 0.021592475473880768, 0.021644227206707, 0.021696440875530243, 0.021748840808868408, 0.021801568567752838, 0.02185465395450592, 0.02190808206796646, 0.021961800754070282, 0.022015869617462158, 0.022070281207561493, 0.02212512493133545, 0.022180207073688507, 0.022235721349716187, 0.022291578352451324, 0.022347785532474518, 0.022404395043849945, 0.02246147394180298, 0.022518761456012726, 0.022576525807380676, 0.022634632885456085, 0.022693239152431488, 0.022752225399017334, 0.022811591625213623, 0.02287132292985916, 0.02293158322572708, 0.022992096841335297, 0.023053184151649475, 0.023114696145057678, 0.02317659556865692, 0.02323899418115616, 0.023301854729652405, 0.023364976048469543, 0.023428693413734436, 0.02349290996789932, 0.023557551205158234, 0.023622609674930573, 0.02368815988302231, 0.02375435084104538, 0.023820899426937103, 0.023887909948825836, 0.023955486714839935, 0.024023421108722687, 0.024092040956020355, 0.02416107803583145, 0.02423068881034851, 0.02430061250925064, 0.02437126636505127, 0.0244423970580101, 0.024514101445674896, 0.024586282670497894, 0.024659015238285065, 0.024732202291488647, 0.024806074798107144, 0.024880491197109222, 0.024955421686172485, 0.02503088116645813, 0.025107011198997498, 0.025183655321598053, 0.02526087313890457, 0.02533863484859467, 0.025417067110538483, 0.02549602836370468, 0.02557557076215744, 0.025655761361122128, 0.025736503303050995, 0.02581787109375, 0.02589985728263855, 0.025982461869716644, 0.026065684854984283, 0.02614959329366684, 0.0262339785695076, 0.026319079101085663, 0.026404835283756256, 0.02649114280939102, 0.02657807618379593, 0.02666579931974411, 0.026754051446914673, 0.02684295922517776, 0.02693255990743637, 0.02702278643846512, 0.027113698422908783, 0.027205243706703186, 0.02729737013578415, 0.027390189468860626, 0.027483679354190826, 0.02757788449525833, 0.02767273038625717, 0.027768142521381378, 0.027864329516887665, 0.027961216866970062, 0.02805863320827484, 0.028156787157058716, 0.028255581855773926, 0.028355009853839874, 0.02845510095357895, 0.02855587750673294, 0.02865728735923767, 0.0287594273686409, 0.028862178325653076, 0.028965577483177185, 0.029069550335407257, 0.029174260795116425, 0.029279552400112152, 0.029385574162006378, 0.029492080211639404, 0.02959936112165451, 0.02970726042985916, 0.029815658926963806, 0.029924675822257996, 0.030034400522708893, 0.03014466911554337, 0.030255578458309174, 0.030366942286491394, 0.030479013919830322, 0.030591614544391632, 0.0307048037648201, 0.03081849217414856, 0.030932776629924774, 0.031047649681568146, 0.031162984669208527, 0.0312788188457489, 0.03139519691467285, 0.03151214122772217, 0.03162951022386551, 0.031747475266456604, 0.03186584264039993, 0.03198469430208206, 0.032104022800922394, 0.03222387284040451, 0.03234409540891647, 0.032464757561683655, 0.03258597105741501, 0.03270753473043442, 0.03282966464757919, 0.03295215219259262, 0.03307510167360306, 0.03319860249757767, 0.03332245349884033, 0.03344682604074478, 0.03357163816690445, 0.03369694948196411, 0.03382279723882675, 0.033949218690395355, 0.034076184034347534, 0.034203581511974335, 0.03433186560869217, 0.03446062654256821, 0.03459024429321289, 0.0347205325961113, 0.03485177457332611, 0.034983858466148376, 0.03511685132980347, 0.03525097668170929, 0.035386301577091224, 0.03552285581827164, 0.03566090762615204, 0.03580038994550705, 0.035941608250141144, 0.03608468174934387, 0.03622976690530777, 0.03637712448835373, 0.036526881158351905, 0.03667934983968735, 0.03683473914861679, 0.03699340671300888, 0.03715554624795914, 0.03732158988714218, 0.037491925060749054, 0.037666790187358856, 0.03784684091806412, 0.038032181560993195, 0.038223691284656525, 0.03842181712388992, 0.03862694650888443, 0.03883974999189377, 0.03906095772981644, 0.039291299879550934, 0.039531417191028595, 0.03978215903043747, 0.04004444926977158, 0.04031909257173538, 0.040607012808322906, 0.040909476578235626, 0.04122716933488846, 0.04156164079904556, 0.04191375523805618, 0.04228506237268448, 0.042676664888858795, 0.043089963495731354, 0.04352653771638871, 0.04398781806230545, 0.04447544366121292, 0.044991083443164825, 0.04553630203008652, 0.04611308127641678, 0.04672304540872574, 0.047368116676807404, 0.04805038124322891, 0.0487716868519783, 0.04953403025865555, 0.05033952742815018, 0.05119027942419052, 0.05208829790353775, 0.053035818040370934, 0.05403486639261246, 0.055087633430957794, 0.05619623512029648, 0.05736271291971207, 0.058589182794094086, 0.05987764149904251, 0.06123004108667374, 0.06264828890562057, 0.0641341581940651, 0.06568936258554459, 0.06731558591127396, 0.06901415437459946, 0.07078651338815689, 0.07263381034135818, 0.07455716282129286, 0.0765574648976326, 0.07863534241914749, 0.08079130202531815, 0.08302564173936844, 0.08533839136362076, 0.08772958070039749, 0.09019873291254044, 0.09274523705244064, 0.09536836296319962, 0.09806708246469498, 0.1008400097489357, 0.10368580371141434, 0.10660258680582047, 0.1095883324742317, 0.1126410588622093, 0.11575827747583389, 0.1189374104142189, 0.12217556685209274, 0.1254698932170868, 0.12881720066070557, 0.13221439719200134, 0.1356576383113861, 0.13914376497268677, 0.14266890287399292, 0.14622938632965088, 0.14982131123542786, 0.15344086289405823, 0.15708410739898682, 0.16074714064598083, 0.1644260287284851, 0.16811659932136536, 0.17181524634361267, 0.1755179464817047, 0.17922085523605347, 0.18292030692100525, 0.18661260604858398, 0.1902940571308136, 0.19396141171455383, 0.1976112425327301, 0.20124009251594543, 0.20484521985054016, 0.2084234058856964, 0.21197181940078735, 0.21548786759376526, 0.2189690172672272, 0.22241294384002686, 0.22581717371940613, 0.22917988896369934, -0.12618574500083923, 0.23711100220680237, -0.12012896686792374, -0.11655785143375398, 0.24930009245872498, -0.11035352200269699, -0.10668947547674179, 0.26102206110954285, -0.10041551291942596, -0.09670878946781158, -0.09300874173641205, 0.2762432992458343, -0.08675945550203323, -0.08305830508470535, -0.07938547432422638, 0.2903975248336792, -0.07329318672418594, -0.06966781616210938, -0.06608796864748001, -0.0625365599989891, 0.30680420994758606, -0.05677574872970581, -0.05331694334745407, -0.049919500946998596, -0.046564169228076935, -0.043253377079963684, -0.039989225566387177, -0.0367734357714653, 0.3300010859966278, -0.03174156695604324, -0.0286572203040123, -0.025647461414337158, -0.022690773010253906, -0.019788116216659546, -0.01693975180387497, -0.014146126806735992, -0.011407412588596344, -0.008723810315132143, -0.0060951560735702515, -0.0035213902592658997, -0.0010022222995758057, 0.001462779939174652, 0.0038738995790481567, 0.006231717765331268, 0.008536741137504578, 0.010789662599563599, 0.012991122901439667, 0.01514185965061188, 0.0172426775097847, 0.019294291734695435, 0.021297655999660492, 0.023253507912158966, 0.02516278624534607, 0.027026273310184482, 0.02884504944086075, 0.030619822442531586, 0.03235170990228653, 0.034041427075862885, 0.035690031945705414, 0.03729843348264694, 0.03886737674474716, 0.04039797931909561, 0.04189092665910721, 0.04334736615419388, 0.044768042862415314, 0.0461537167429924, 0.04750529676675796, 0.048823706805706024, 0.050109632313251495, 0.05136401206254959, 0.05258768051862717, 0.053781233727931976, 0.05494556576013565, 0.056081391870975494, 0.057189397513866425, 0.05827034264802933, 0.05932503193616867, 0.06035395711660385, 0.06135786324739456, 0.06233728677034378, 0.06329312175512314, 0.06422583013772964, 0.06513596326112747, 0.06602426618337631, 0.0668911263346672, 0.0677371695637703, 0.06856299191713333, 0.06936905533075333, 0.07015600055456161, 0.07092405110597609, 0.07167399674654007, 0.07240615040063858, 0.07312094420194626, 0.07381892949342729, 0.0745004191994667, 0.0751659944653511, 0.07581593841314316, 0.07645059376955032, 0.07707054167985916, 0.07767603546380995, 0.078267402946949, 0.07884515076875687, 0.07940936833620071, 0.07996063679456711, 0.08049913495779037, 0.08102528005838394, 0.08153931051492691, 0.08204153925180435, 0.08253223448991776, 0.083011694252491, 0.08348017185926437, 0.08393805474042892, 0.08438534289598465, 0.08482261747121811, 0.08524984866380692, 0.08566742390394211, 0.08607534319162369, 0.0864742323756218, 0.08686398714780807, 0.08724489063024521, 0.08761712163686752, 0.0879809781908989, 0.08833662420511246, 0.08868416398763657, 0.0890238955616951, 0.08935589343309402, 0.08968039602041245, 0.08999746292829514, 0.09030739217996597, 0.09061030298471451, 0.09090632945299149, 0.09119557589292526, 0.09147831052541733, 0.09175457805395126, 0.09202448278665543, 0.0922883078455925, 0.0925460085272789, 0.09279776364564896, 0.09304384142160416, 0.0932842269539833, 0.09351897984743118, 0.09374827891588212, 0.09397231787443161, 0.09419108182191847, 0.09440480917692186, 0.09461342543363571, 0.09481716901063919, 0.09501603990793228, 0.09521020203828812, 0.09539980441331863, 0.09558480232954025, 0.09576534479856491, 0.09594156593084335, 0.0961134061217308, 0.09628108888864517, 0.09644458442926407, 0.0966041162610054, 0.09675972908735275, 0.09691128879785538, 0.09705909341573715, 0.09720314294099808, 0.09734352678060532, 0.09748021513223648, 0.09761332720518112, 0.09774301201105118, 0.09786925464868546, 0.09799212962388992, 0.09811162203550339, 0.09822792559862137, 0.09834101051092148, 0.09845095127820969, 0.09855780750513077, 0.09866165369749069, 0.09876248985528946, 0.09886040538549423, 0.09895545989274979, 0.09904766827821732, 0.09913706034421921, 0.0992237702012062, 0.09930776804685593, 0.09938912838697433, 0.09946791082620621, 0.09954402595758438, 0.09961771219968796, 0.09968895465135573, 0.09975772351026535, 0.09982413798570633, 0.0998881384730339, 0.09994993358850479, 0.10000935941934587, 0.10006650537252426, 0.1001216396689415, 0.10017453879117966, 0.10022517293691635, 0.10027384012937546, 0.1003204956650734, 0.10036500543355942, 0.10040759295225143, 0.10044827312231064, 0.10048698633909225, 0.10052383691072464, 0.100558839738369, 0.1005919948220253, 0.10062339156866074, 0.10065304487943649, 0.10068092495203018, 0.10070710629224777, 0.10073170810937881, 0.10075456649065018, 0.10077586024999619, 0.10079557448625565, 0.10081370919942856, 0.10083033889532089, 0.10084549337625504, 0.10085923224687576, 0.10087152570486069, 0.10088231414556503, 0.10089192539453506, 0.10090001672506332, 0.10090679675340652, 0.1009124144911766, 0.10091664642095566, 0.10091971606016159, 0.10092157870531084, 0.10092223435640335, 0.10092172771692276, 0.10092007368803024, 0.10091731697320938, 0.10091353207826614, 0.10090873390436172, 0.10090287774801254, 0.10089597851037979, 0.1008882001042366, 0.10087942332029343, 0.10086978226900101, 0.10085930675268173, 0.10084789246320724, 0.10083570331335068, 0.10082269459962845, 0.10080897063016891, 0.10079445689916611, 0.10077924281358719, 0.10076338797807693, 0.10074687749147415, 0.10072968155145645, 0.10071196407079697, 0.10069369524717331, 0.10067480057477951, 0.10065556317567825, 0.10063574463129044, 0.1006154790520668, 0.10059493035078047, 0.10057387501001358, 0.10055262595415115, 0.10053090006113054, 0.10050896555185318, 0.10048682242631911, 0.10046445578336716, 0.10044191032648087, 0.10041920095682144, 0.10039641708135605, 0.10037367790937424, 0.10035077482461931, 0.1003279760479927, 0.10030508786439896, 0.10028242319822311, 0.10025986284017563, 0.10023743659257889, 0.10021523386240005, 0.10019334405660629, 0.10017173737287521, 0.1001504585146904, 0.1001296415925026, 0.10010910779237746, 0.1000891700387001, 0.10006975382566452, 0.10005088895559311, 0.10003272444009781, 0.10001523047685623, 0.09999845176935196, 0.09998247772455217, 0.0999673530459404, 0.09995316714048386, 0.09993990510702133, 0.09992773085832596, 0.09991658478975296, 0.09990664571523666, 0.09989789873361588, 0.09989050775766373, 0.09988453239202498, 0.09987994283437729, 0.09987685829401018, 0.09987538307905197, 0.09987565129995346, 0.09987758845090866, 0.09988138824701309, 0.09988721460103989, 0.09989502280950546, 0.09990500658750534, 0.09991716593503952, 0.09993160516023636, 0.09994862228631973, 0.0999680832028389, 0.09999018162488937, 0.10001515597105026, 0.10004302114248276, 0.10007394105195999, 0.10010800510644913, 0.10014539211988449, 0.1001862958073616, 0.10023068636655807, 0.10027899593114853]


def simulate(pause=False):

    for episode in range(1, TEST_EPISODES + 1):
        # Initialise the  environment
        environment = gym.make("ACAS2D-v0")
        # At the first episode, check the environment
        if episode == 1:
            check_env(environment, warn=True, skip_render_check=True)
        # Reset the environment
        state = environment.reset()
        # Set game episode
        environment.game.episode = episode
        # AI tries up to MAX_TRY times
        for t in range(MAX_STEPS):
            # Quit if the game window closes
            if environment.game.quit:
                return -1
            # Fixed action selection policy
            # action = np.array([np.cos(((t % 360) / 360) * (2 * math.pi))])
            action = np.array([(episode % 3)-1])
            # action = np.array([0])
            # try:
            #     action = np.array([actions[t]])
            # except IndexError:
            #     pass
            # Do action and get result
            next_state, reward, done, info = environment.step(action)
            # total_reward += reward
            # Set up for the next iteration
            state = next_state
            # Draw games
            environment.render()
            # When episode is done, print reward
            if done:
                print("Episode {:<3}: Time steps: {:<7} - Outcome: {:<10} - Total Reward = {}"
                      .format(episode, t, OUTCOME_NAMES[environment.game.outcome], environment.game.total_reward))
                break
            # Pause the game screen to start video capture
            if pause and episode == 0 and t == 0:
                input("Press any key to continue")
    return 0


if __name__ == "__main__":
    try:
        simulate(pause=False)
    except KeyboardInterrupt:
        pass
